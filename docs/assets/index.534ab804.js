var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,a=(t,l,o)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[l]=o,r=(e,t)=>{for(var l in t||(t={}))n.call(t,l)&&a(e,l,t[l]);if(o)for(var l of o(t))i.call(t,l)&&a(e,l,t[l]);return e};import{d as s,r as c,a as d,w as g,o as p,b as f,t as m,n as h,c as u,e as _,F as y,f as x,g as b,h as w,i as v,p as E,j as S,k as L,l as P,m as W,q as I,s as M,u as R}from"./vendor.a0fbe6f6.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(l){const o=new URL(e,location),n=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((l,i)=>{const a=new URL(e,o);if(self[t].moduleMap[a])return l(self[t].moduleMap[a]);const r=new Blob([`import * as m from '${a}';`,`${t}.moduleMap['${a}']=m;`],{type:"text/javascript"}),s=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){i(new Error(`Failed to import: ${e}`)),n(s)},onload(){l(self[t].moduleMap[a]),n(s)}});document.head.appendChild(s)})),self[t].moduleMap={}}}("/vue3-waterfall/assets/");var O=s({name:"VueWaterfall",props:{width:Number,height:Number,colWidth:Number,cols:Number,gap:{type:Number,default:15},footerHeight:{type:Number,default:0},list:{type:Array,default:()=>[]},scrollDisabled:{type:Boolean,default:!1},scrollDelay:{type:Number,default:200},scrollDistance:{type:Number,default:0},scrollImmediate:{type:Boolean,default:!0}},setup(e,o){const n=c({containerWidth:e.width||0,colW:e.colWidth||240,colC:e.cols||0,beginIndex:0,heightArr:[],waterfallList:[],isPreloading:!1}),i=d(null),a=()=>{if(!e.width){const e=document.querySelector("#waterfallBox");e&&(n.containerWidth=e.offsetWidth)}if(e.cols?n.colW=Math.floor((n.containerWidth-(e.cols-1)*e.gap)/e.cols):n.colC=Math.floor(n.containerWidth/(n.colW+e.gap)),0===n.beginIndex){n.waterfallList=[],n.heightArr=new Array(n.colC);for(let e=0;e<n.heightArr.length;e++)n.heightArr[e]=0}s()},s=()=>{if(console.log("当前索引：",n),n.isPreloading||!e.list.length)return!1;n.isPreloading=!0;for(let t=n.beginIndex;t<e.list.length;t++){const l=e.list[t];let i=new Image;i.src=l.imgSrc,i.onload=i.onerror=a=>{const r=u();l._width=n.colW,l._height=Math.floor(n.colW*i.height/i.width+e.footerHeight),l._top=n.heightArr[r],l._left=r*(l._width+e.gap),n.heightArr[r]+=l._height+e.gap,n.waterfallList.push(l),"error"===a.type&&(l._error=!0,o.emit("imageError",l)),console.log("i:",t,n.beginIndex,n.waterfallList),t===e.list.length-1&&(n.beginIndex=n.waterfallList.length,o.emit("preLoaded"),n.isPreloading=!1,e.scrollDisabled||e.scrollImmediate&&y())}}},u=()=>{const e=Math.min.apply(null,n.heightArr);return n.heightArr.indexOf(e)},_=()=>{n.beginIndex=0,a()},y=()=>{if(n.isPreloading)return!1;const t=i.value,l=Math.max.apply(null,n.heightArr);null!==t&&console.log((null==t?void 0:t.scrollTop)+(null==t?void 0:t.offsetHeight)+e.gap,l-e.scrollDistance),null!==t&&t.scrollTop+t.offsetHeight+e.gap>=l-e.scrollDistance&&(n.isPreloading=!0,o.emit("scrollReachBottom"),console.log("触底"))};return g((()=>e.list),((e,t)=>{console.log("变动",e,t),e.length?t&&t.length?t.length!==e.length&&(n.isPreloading=!1,s()):h((()=>{a()})):(n.beginIndex=0,n.isPreloading=!1,a())}),{immediate:!0}),p((()=>{window.addEventListener("resize",_),e.scrollDisabled||null===i.value||i.value.addEventListener("scroll",y)})),f((()=>{window.removeEventListener("resize",_)})),x=r(r({},m(n)),m(e)),t(x,l({scrollElRef:i}));var x}});const j=v();E("data-v-08a8f40c");const A={class:"vue3-waterfall",id:"waterfallBox"},D={class:"vue3-waterfall-scroller",ref:"scrollElRef"},B={class:"vue3-waterfall-item_image"},C={class:"title"},N={class:"info"},T={key:0,class:"vue3-waterfall-loading"},$=W(" 加载中... ");S();const F=j(((e,t,l,o,n,i)=>(L(),u("div",A,[_("div",D,[(L(!0),u(y,null,x(e.waterfallList,((t,l)=>(L(),u("div",{key:l,class:"vue3-waterfall-item",style:{top:t._top+"px",left:t._left+"px",width:t._width+"px",height:t._height+"px"}},[_("div",B,[b(e.$slots,"default",{item:t},(()=>[_("img",{src:t.imgSrc},null,8,["src"])]),!0)]),_("div",{class:"vue3-waterfall-item_footer",style:{height:e.footerHeight+"px"}},[b(e.$slots,"footer",{item:t},(()=>[_("p",C,P(t.title),1),_("p",N,P(t.info),1)]),!0)],4)],4)))),128))],512),e.isPreloading?(L(),u("div",T,[b(e.$slots,"loading",{},(()=>[$]),{})])):w("",!0)]))));O.render=F,O.__scopeId="data-v-08a8f40c";var H=s({name:"App",data:()=>({list:[]}),components:{Waterfall:O},methods:{loadMore(){this.list.length>20&&(this.list=[]),setTimeout((()=>{this.list=this.list.concat([{id:11,imgSrc:"https://cdn.xnycloud.com/xny-data/_b6314ece09.png",title:"111",info:"222"},{id:12,imgSrc:"https://cdn.xnycloud.com/xny-data/Financing_Clean_Energy_Transitionsin_EMD_Es_World_Energy_Investment_2021_Special_Report_29174d6289.png",title:"111",info:"222"},{id:13,imgSrc:"https://cdn.xnycloud.com/xny-data/2060_df48245eba.png",title:"111",info:"222"}])}),1e3)},loadedEnd(){console.log("图片预加载完成")}},mounted(){setTimeout((()=>{this.list=[{id:1,imgSrc:"https://cdn.xnycloud.com/xny-data/_f26d6f3e95.png",title:"1",info:"222"},{id:2,imgSrc:"https://cdn.xnycloud.com/xny-data/_d53e0ea860.png",title:"6",info:"222"},{id:3,imgSrc:"https://cdn.xnycloud.com/xny-data/_b6314ece09.png",title:"4",info:"222"},{id:4,imgSrc:"https://cdn.xnycloud.com/xny-data/_f26d6f3e95.png",title:"111",info:"222"},{id:5,imgSrc:"https://cdn.xnycloud.com/xny-data/Financing_Clean_Energy_Transitionsin_EMD_Es_World_Energy_Investment_2021_Special_Report_29174d6289.png",title:"111",info:"222"},{id:6,imgSrc:"https://cdn.xnycloud.com/xny-data/Renewable_Power_Generation_Costs_in_2020_614291a015.png",title:"111",info:"222"},{id:7,imgSrc:"https://cdn.xnycloud.com/xny-data/_8fa7009f0b.png",title:"111",info:"222"},{id:8,imgSrc:"https://cdn.xnycloud.com/xny-data/_b6314ece09.png",title:"111",info:"222"},{id:9,imgSrc:"https://cdn.xnycloud.com/xny-data/Financing_Clean_Energy_Transitionsin_EMD_Es_World_Energy_Investment_2021_Special_Report_29174d6289.png",title:"111",info:"222"},{id:10,imgSrc:"https://cdn.xnycloud.com/xny-data/2060_df48245eba.png",title:"111",info:"222"}]}),3e3)}});const U={class:"imgbox"},k=_("span",null,"正在拼命加载中...",-1);H.render=function(e,t,l,o,n,i){const a=M("waterfall");return L(),u(a,{list:e.list,cols:4,footerHeight:60,gap:15,scrollDistance:10,onPreLoaded:e.loadedEnd,onScrollReachBottom:e.loadMore},{default:I((({item:e})=>[_("div",U,[_("img",{src:e.imgSrc,alt:e.title},null,8,["src","alt"])])])),footer:I((({item:e})=>[_("span",null,P(e.id),1)])),loading:I((()=>[k])),_:1},8,["list","onPreLoaded","onScrollReachBottom"])},R(H).mount("#app");
