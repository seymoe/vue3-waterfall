!function(){function t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function e(e){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?t(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function n(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var i=document.createElement("style");i.innerHTML=".vue3-waterfall[data-v-898cf99e]{position:relative;width:100%;height:100%}.vue3-waterfall-scroller[data-v-898cf99e]{position:relative;width:100%;height:100%;overflow-x:hidden;overflow-y:scroll;-webkit-overflow-scrolling:touch}.vue3-waterfall-item[data-v-898cf99e]{position:absolute;box-sizing:border-box;box-shadow:0 2px 6px 0 rgb(0 0 0 / 10%)}.vue3-waterfall-item img[data-v-898cf99e]{display:block;width:100%;height:auto}.vue3-waterfall-item_footer[data-v-898cf99e]{overflow:hidden}.vue3-waterfall-item_footer .title[data-v-898cf99e]{margin:0}.vue3-waterfall-item_footer .info[data-v-898cf99e]{margin:0}.vue3-waterfall-loading[data-v-898cf99e]{position:absolute;bottom:15px;width:100%;text-align:center}.vue3-waterfall-nomore[data-v-898cf99e]{padding:20px 0;width:100%;text-align:center}#app,body,html{width:100%;height:100%}body{margin:0}#app{width:100%;margin:0 auto;font-family:Avenir,Helvetica,Arial,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;color:#2c3e50}.imgbox{border-radius:6px;overflow:hidden}.imgbox img{display:block;width:100%;box-sizing:border-box}",document.head.appendChild(i),System.register(["./vendor-legacy.0de6ed45.js"],(function(){"use strict";var t,n,i,o,l,r,a,c,d,s,f,u,g,h,p,m,v,y,_,b,w,x,S,E;return{setters:[function(e){t=e.d,n=e.r,i=e.a,o=e.c,l=e.w,r=e.o,a=e.b,c=e.t,d=e.n,s=e.e,f=e.f,u=e.F,g=e.g,h=e.h,p=e.i,m=e.j,v=e.p,y=e.k,_=e.l,b=e.m,w=e.q,x=e.s,S=e.u,E=e.v}],execute:function(){var P=t({name:"VueWaterfall",props:{width:Number,height:Number,colWidth:Number,cols:Number,gap:{type:Number,default:15},footerHeight:{type:Number,default:0},list:{type:Array,default:function(){return[]}},total:{type:Number,default:0},scrollDisabled:{type:Boolean,default:!1},scrollDelay:{type:Number,default:200},scrollDistance:{type:Number,default:0},scrollImmediate:{type:Boolean,default:!0}},setup:function(t,s){var f=n({containerWidth:t.width||0,colW:t.colWidth||240,colC:t.cols||0,beginIndex:0,heightArr:[],waterfallList:[],isPreloading:!1}),u=i(null),g=o((function(){return t.list.length>=t.total})),h=function(){if(!t.width){var e=document.querySelector("#waterfallBox");e&&(f.containerWidth=e.offsetWidth)}if(t.cols?f.colW=Math.floor((f.containerWidth-(t.cols-1)*t.gap)/t.cols):f.colC=Math.floor(f.containerWidth/(f.colW+t.gap)),0===f.beginIndex){f.waterfallList=[],f.heightArr=new Array(f.colC);for(var n=0;n<f.heightArr.length;n++)f.heightArr[n]=0}p()},p=function(){if(console.log(f,t,g.value),f.isPreloading||!t.list.length||g.value)return!1;f.isPreloading=!0;for(var e=function(e){var n=t.list[e],i=new Image;i.src=n.imgSrc,i.onload=i.onerror=function(o){var l=m();n._width=f.colW,n._height=Math.floor(f.colW*i.height/i.width+t.footerHeight),n._top=f.heightArr[l],n._left=l*(n._width+t.gap),f.heightArr[l]+=n._height+t.gap,f.waterfallList.push(n),"error"===o.type&&(n._error=!0,s.emit("imageError",n)),e===t.list.length-1&&(f.beginIndex=t.list.length,s.emit("preLoaded"),f.isPreloading=!1,t.scrollDisabled||t.scrollImmediate&&y())}},n=f.beginIndex;n<t.list.length;n++)e(n)},m=function(){var t=Math.min.apply(null,f.heightArr);return f.heightArr.indexOf(t)},v=function(){f.beginIndex=0,h()},y=function(){if(f.isPreloading||g.value)return!1;var e=u.value,n=Math.max.apply(null,f.heightArr);null!==e&&e.scrollTop+e.offsetHeight+t.gap>=n-t.scrollDistance&&(f.isPreloading=!0,s.emit("scrollReachBottom"))};return l((function(){return t.list}),(function(t,e){t.length?e&&e.length?e.length!==t.length&&(f.isPreloading=!1,p()):(console.log("watch了！ ",t,e),d((function(){h()}))):(f.beginIndex=0,f.isPreloading=!1,h())}),{immediate:!0}),r((function(){window.addEventListener("resize",v),t.scrollDisabled||null===u.value||u.value.addEventListener("scroll",y)})),a((function(){window.removeEventListener("resize",v)})),e(e(e({},c(f)),c(t)),{},{scrollElRef:u})}}),O=m();v("data-v-898cf99e");var W={class:"vue3-waterfall",id:"waterfallBox"},j={class:"vue3-waterfall-scroller",ref:"scrollElRef"},A={class:"vue3-waterfall-item_image"},D={class:"title"},I={class:"info"},L={key:0,class:"vue3-waterfall-loading"},M=w(" 加载中... "),k={key:1,class:"vue3-waterfall-nomore"},N=w(" 没有更多数据了 ");y();var R=O((function(t,e,n,i,o,l){return _(),s("div",W,[f("div",j,[(_(!0),s(u,null,g(t.waterfallList,(function(e,n){return _(),s("div",{key:n,class:"vue3-waterfall-item",style:{top:e._top+"px",left:e._left+"px",width:e._width+"px",height:e._height+"px"}},[f("div",A,[h(t.$slots,"default",{item:e},(function(){return[f("img",{src:e.imgSrc},null,8,["src"])]}),!0)]),f("div",{class:"vue3-waterfall-item_footer",style:{height:t.footerHeight+"px"}},[h(t.$slots,"footer",{item:e},(function(){return[f("p",D,b(e.title),1),f("p",I,b(e.info),1)]}),!0)],4)],4)})),128))],512),t.isPreloading&&t.list.length<t.total?(_(),s("div",L,[h(t.$slots,"loading",{},(function(){return[M]}),{})])):p("",!0),t.list.length>=t.total?(_(),s("div",k,[h(t.$slots,"nomore",{},(function(){return[N]}),{})])):p("",!0)])}));P.render=R,P.__scopeId="data-v-898cf99e";var C=t({name:"App",data:function(){return{list:[],total:30}},components:{Waterfall:P},methods:{loadMore:function(){var t=this;setTimeout((function(){t.list=t.list.concat([{id:11,imgSrc:"https://cdn.xnycloud.com/xny-data/_b6314ece09.png",title:"111",info:"222"},{id:12,imgSrc:"https://cdn.xnycloud.com/xny-data/Financing_Clean_Energy_Transitionsin_EMD_Es_World_Energy_Investment_2021_Special_Report_29174d6289.png",title:"111",info:"222"},{id:13,imgSrc:"https://cdn.xnycloud.com/xny-data/2060_df48245eba.png",title:"111",info:"222"}])}),1e3)},loadedEnd:function(){console.log("图片预加载完成")}},mounted:function(){var t=this;setTimeout((function(){t.list=[{id:1,imgSrc:"https://cdn.xnycloud.com/xny-data/_f26d6f3e95.png",title:"1",info:"222"},{id:2,imgSrc:"https://cdn.xnycloud.com/xny-data/_d53e0ea860.png",title:"6",info:"222"},{id:3,imgSrc:"https://cdn.xnycloud.com/xny-data/_b6314ece09.png",title:"4",info:"222"},{id:4,imgSrc:"https://cdn.xnycloud.com/xny-data/_f26d6f3e95.png",title:"111",info:"222"},{id:5,imgSrc:"https://cdn.xnycloud.com/xny-data/Financing_Clean_Energy_Transitionsin_EMD_Es_World_Energy_Investment_2021_Special_Report_29174d6289.png",title:"111",info:"222"},{id:6,imgSrc:"https://cdn.xnycloud.com/xny-data/Renewable_Power_Generation_Costs_in_2020_614291a015.png",title:"111",info:"222"},{id:7,imgSrc:"https://cdn.xnycloud.com/xny-data/_8fa7009f0b.png",title:"111",info:"222"},{id:8,imgSrc:"https://cdn.xnycloud.com/xny-data/_b6314ece09.png",title:"111",info:"222"},{id:9,imgSrc:"https://cdn.xnycloud.com/xny-data/Financing_Clean_Energy_Transitionsin_EMD_Es_World_Energy_Investment_2021_Special_Report_29174d6289.png",title:"111",info:"222"},{id:10,imgSrc:"https://cdn.xnycloud.com/xny-data/2060_df48245eba.png",title:"111",info:"222"}]}),3e3)}}),B={class:"imgbox"},H=f("span",null,"正在拼命加载中...",-1),T=f("span",null,"没有更多数据了...",-1);C.render=function(t,e,n,i,o,l){var r=S("waterfall");return _(),s(r,{list:t.list,cols:4,footerHeight:0,gap:15,scrollDistance:10,total:t.total,onPreLoaded:t.loadedEnd,onScrollReachBottom:t.loadMore},{default:x((function(t){var e=t.item;return[f("div",B,[f("img",{src:e.imgSrc,alt:e.title},null,8,["src","alt"])])]})),footer:x((function(t){var e=t.item;return[f("span",null,b(e.id),1)]})),loading:x((function(){return[H]})),nomore:x((function(){return[T]})),_:1},8,["list","total","onPreLoaded","onScrollReachBottom"])},E(C).mount("#app")}}}))}();
