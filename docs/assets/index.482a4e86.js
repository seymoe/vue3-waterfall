var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,a=(t,l,n)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[l]=n,r=(e,t)=>{for(var l in t||(t={}))i.call(t,l)&&a(e,l,t[l]);if(n)for(var l of n(t))o.call(t,l)&&a(e,l,t[l]);return e};import{d as s,r as c,a as d,w as g,o as p,b as m,t as f,n as h,c as u,e as _,F as y,f as x,g as b,h as w,i as v,p as E,j as S,k as P,l as L,m as W,q as M,s as R,u as I}from"./vendor.a0fbe6f6.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(l){const n=new URL(e,location),i=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((l,o)=>{const a=new URL(e,n);if(self[t].moduleMap[a])return l(self[t].moduleMap[a]);const r=new Blob([`import * as m from '${a}';`,`${t}.moduleMap['${a}']=m;`],{type:"text/javascript"}),s=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){o(new Error(`Failed to import: ${e}`)),i(s)},onload(){l(self[t].moduleMap[a]),i(s)}});document.head.appendChild(s)})),self[t].moduleMap={}}}("/vue3-waterfall/assets/");var O=s({name:"VueWaterfall",props:{width:Number,height:Number,colWidth:Number,cols:Number,gap:{type:Number,default:15},footerHeight:{type:Number,default:0},list:{type:Array,default:()=>[]},scrollDisabled:{type:Boolean,default:!1},scrollDelay:{type:Number,default:200},scrollDistance:{type:Number,default:0},scrollImmediate:{type:Boolean,default:!0}},setup(e,n){const i=c({containerWidth:e.width||0,colW:e.colWidth||240,colC:e.cols||0,beginIndex:0,heightArr:[],waterfallList:[],isPreloading:!1}),o=d(null),a=()=>{if(!e.width){const e=document.querySelector("#waterfallBox");e&&(i.containerWidth=e.offsetWidth)}if(e.cols?i.colW=Math.floor((i.containerWidth-(e.cols-1)*e.gap)/e.cols):i.colC=Math.floor(i.containerWidth/(i.colW+e.gap)),0===i.beginIndex){i.waterfallList=[],i.heightArr=new Array(i.colC);for(let e=0;e<i.heightArr.length;e++)i.heightArr[e]=0}s()},s=()=>{if(i.isPreloading||!e.list.length)return!1;i.isPreloading=!0;for(let t=i.beginIndex;t<e.list.length;t++){const l=e.list[t];let o=new Image;o.src=l.imgSrc,o.onload=o.onerror=a=>{const r=u();l._width=i.colW,l._height=Math.floor(i.colW*o.height/o.width+e.footerHeight),l._top=i.heightArr[r],l._left=r*(l._width+e.gap),i.heightArr[r]+=l._height+e.gap,i.waterfallList.push(l),"error"===a.type&&(l._error=!0,n.emit("imageError",l)),t===e.list.length-1&&(i.beginIndex=i.waterfallList.length,n.emit("preLoaded"),i.isPreloading=!1,e.scrollDisabled||e.scrollImmediate&&y())}}},u=()=>{const e=Math.min.apply(null,i.heightArr);return i.heightArr.indexOf(e)},_=()=>{i.beginIndex=0,a()},y=()=>{if(i.isPreloading)return!1;const t=o.value,l=Math.max.apply(null,i.heightArr);null!==t&&t.scrollTop+t.offsetHeight+e.gap>=l-e.scrollDistance&&(i.isPreloading=!0,n.emit("scrollReachBottom"))};return g((()=>e.list),((e,t)=>{e.length?t&&t.length?t.length!==e.length&&(i.isPreloading=!1,s()):h((()=>{a()})):(i.beginIndex=0,i.isPreloading=!1,a())}),{immediate:!0}),p((()=>{window.addEventListener("resize",_),e.scrollDisabled||null===o.value||o.value.addEventListener("scroll",y)})),m((()=>{window.removeEventListener("resize",_)})),x=r(r({},f(i)),f(e)),t(x,l({scrollElRef:o}));var x}});const j=v();E("data-v-a68501e6");const A={class:"vue3-waterfall",id:"waterfallBox"},D={class:"vue3-waterfall-scroller",ref:"scrollElRef"},B={class:"vue3-waterfall-item_image"},C={class:"title"},N={class:"info"},$={key:0,class:"vue3-waterfall-loading"},F=W(" 加载中... ");S();const T=j(((e,t,l,n,i,o)=>(P(),u("div",A,[_("div",D,[(P(!0),u(y,null,x(e.waterfallList,((t,l)=>(P(),u("div",{key:l,class:"vue3-waterfall-item",style:{top:t._top+"px",left:t._left+"px",width:t._width+"px",height:t._height+"px"}},[_("div",B,[b(e.$slots,"default",{item:t},(()=>[_("img",{src:t.imgSrc},null,8,["src"])]),!0)]),_("div",{class:"vue3-waterfall-item_footer",style:{height:e.footerHeight+"px"}},[b(e.$slots,"footer",{item:t},(()=>[_("p",C,L(t.title),1),_("p",N,L(t.info),1)]),!0)],4)],4)))),128))],512),e.isPreloading?(P(),u("div",$,[b(e.$slots,"loading",{},(()=>[F]),{})])):w("",!0)]))));O.render=T,O.__scopeId="data-v-a68501e6";var U=s({name:"App",data:()=>({list:[]}),components:{Waterfall:O},methods:{loadMore(){this.list.length>100&&(this.list=[]),setTimeout((()=>{this.list=this.list.concat([{id:11,imgSrc:"https://cdn.xnycloud.com/xny-data/_b6314ece09.png",title:"111",info:"222"},{id:12,imgSrc:"https://cdn.xnycloud.com/xny-data/Financing_Clean_Energy_Transitionsin_EMD_Es_World_Energy_Investment_2021_Special_Report_29174d6289.png",title:"111",info:"222"},{id:13,imgSrc:"https://cdn.xnycloud.com/xny-data/2060_df48245eba.png",title:"111",info:"222"}])}),1e3)},loadedEnd(){console.log("图片预加载完成")}},mounted(){setTimeout((()=>{this.list=[{id:1,imgSrc:"https://cdn.xnycloud.com/xny-data/_f26d6f3e95.png",title:"1",info:"222"},{id:2,imgSrc:"https://cdn.xnycloud.com/xny-data/_d53e0ea860.png",title:"6",info:"222"},{id:3,imgSrc:"https://cdn.xnycloud.com/xny-data/_b6314ece09.png",title:"4",info:"222"},{id:4,imgSrc:"https://cdn.xnycloud.com/xny-data/_f26d6f3e95.png",title:"111",info:"222"},{id:5,imgSrc:"https://cdn.xnycloud.com/xny-data/Financing_Clean_Energy_Transitionsin_EMD_Es_World_Energy_Investment_2021_Special_Report_29174d6289.png",title:"111",info:"222"},{id:6,imgSrc:"https://cdn.xnycloud.com/xny-data/Renewable_Power_Generation_Costs_in_2020_614291a015.png",title:"111",info:"222"},{id:7,imgSrc:"https://cdn.xnycloud.com/xny-data/_8fa7009f0b.png",title:"111",info:"222"},{id:8,imgSrc:"https://cdn.xnycloud.com/xny-data/_b6314ece09.png",title:"111",info:"222"},{id:9,imgSrc:"https://cdn.xnycloud.com/xny-data/Financing_Clean_Energy_Transitionsin_EMD_Es_World_Energy_Investment_2021_Special_Report_29174d6289.png",title:"111",info:"222"},{id:10,imgSrc:"https://cdn.xnycloud.com/xny-data/2060_df48245eba.png",title:"111",info:"222"}]}),3e3)}});const H={class:"imgbox"},k=_("span",null,"正在拼命加载中...",-1);U.render=function(e,t,l,n,i,o){const a=R("waterfall");return P(),u(a,{list:e.list,cols:4,footerHeight:0,gap:15,scrollDistance:10,onPreLoaded:e.loadedEnd,onScrollReachBottom:e.loadMore},{default:M((({item:e})=>[_("div",H,[_("img",{src:e.imgSrc,alt:e.title},null,8,["src","alt"])])])),footer:M((({item:e})=>[_("span",null,L(e.id),1)])),loading:M((()=>[k])),_:1},8,["list","onPreLoaded","onScrollReachBottom"])},I(U).mount("#app");
