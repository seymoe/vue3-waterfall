var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,i=(t,l,o)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[l]=o,r=(e,t)=>{for(var l in t||(t={}))n.call(t,l)&&i(e,l,t[l]);if(o)for(var l of o(t))a.call(t,l)&&i(e,l,t[l]);return e};import{d as s,r as c,a as d,c as g,w as p,o as m,b as f,t as h,n as u,e as _,f as y,F as v,g as w,h as x,i as b,j as E,p as S,k as P,l as W,m as L,q as M,s as R,u as I,v as O}from"./vendor.4d3f90e2.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(l){const o=new URL(e,location),n=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((l,a)=>{const i=new URL(e,o);if(self[t].moduleMap[i])return l(self[t].moduleMap[i]);const r=new Blob([`import * as m from '${i}';`,`${t}.moduleMap['${i}']=m;`],{type:"text/javascript"}),s=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){a(new Error(`Failed to import: ${e}`)),n(s)},onload(){l(self[t].moduleMap[i]),n(s)}});document.head.appendChild(s)})),self[t].moduleMap={}}}("/vue3-waterfall/assets/");var j=s({name:"VueWaterfall",props:{width:Number,height:Number,colWidth:Number,cols:Number,gap:{type:Number,default:15},footerHeight:{type:Number,default:0},list:{type:Array,default:()=>[]},total:{type:Number,default:0},scrollDisabled:{type:Boolean,default:!1},scrollDelay:{type:Number,default:200},scrollDistance:{type:Number,default:0},scrollImmediate:{type:Boolean,default:!0}},setup(e,o){const n=c({containerWidth:e.width||0,colW:e.colWidth||240,colC:e.cols||0,beginIndex:0,heightArr:[],waterfallList:[],isPreloading:!1}),a=d(null),i=g((()=>e.list.length>=e.total)),s=()=>{if(!e.width){const e=document.querySelector("#waterfallBox");e&&(n.containerWidth=e.offsetWidth)}if(e.cols?n.colW=Math.floor((n.containerWidth-(e.cols-1)*e.gap)/e.cols):n.colC=Math.floor(n.containerWidth/(n.colW+e.gap)),0===n.beginIndex){n.waterfallList=[],n.heightArr=new Array(n.colC);for(let e=0;e<n.heightArr.length;e++)n.heightArr[e]=0}_()},_=()=>{if(console.log(n,e,i.value),n.isPreloading||!e.list.length||i.value)return!1;n.isPreloading=!0;for(let t=n.beginIndex;t<e.list.length;t++){const l=e.list[t];let a=new Image;a.src=l.imgSrc,a.onload=a.onerror=i=>{const r=y();l._width=n.colW,l._height=Math.floor(n.colW*a.height/a.width+e.footerHeight),l._top=n.heightArr[r],l._left=r*(l._width+e.gap),n.heightArr[r]+=l._height+e.gap,n.waterfallList.push(l),"error"===i.type&&(l._error=!0,o.emit("imageError",l)),t===e.list.length-1&&(n.beginIndex=e.list.length,o.emit("preLoaded"),n.isPreloading=!1,e.scrollDisabled||e.scrollImmediate&&w())}}},y=()=>{const e=Math.min.apply(null,n.heightArr);return n.heightArr.indexOf(e)},v=()=>{n.beginIndex=0,s()},w=()=>{if(n.isPreloading||i.value)return!1;const t=a.value,l=Math.max.apply(null,n.heightArr);null!==t&&t.scrollTop+t.offsetHeight+e.gap>=l-e.scrollDistance&&(n.isPreloading=!0,o.emit("scrollReachBottom"))};return p((()=>e.list),((e,t)=>{e.length?t&&t.length?t.length!==e.length&&(n.isPreloading=!1,_()):(console.log("watch了！ ",e,t),u((()=>{s()}))):(n.beginIndex=0,n.isPreloading=!1,s())}),{immediate:!0}),m((()=>{window.addEventListener("resize",v),e.scrollDisabled||null===a.value||a.value.addEventListener("scroll",w)})),f((()=>{window.removeEventListener("resize",v)})),x=r(r({},h(n)),h(e)),t(x,l({scrollElRef:a}));var x}});const A=E();S("data-v-898cf99e");const D={class:"vue3-waterfall",id:"waterfallBox"},N={class:"vue3-waterfall-scroller",ref:"scrollElRef"},B={class:"vue3-waterfall-item_image"},C={class:"title"},$={class:"info"},F={key:0,class:"vue3-waterfall-loading"},T=M(" 加载中... "),U={key:1,class:"vue3-waterfall-nomore"},k=M(" 没有更多数据了 ");P();const H=A(((e,t,l,o,n,a)=>(W(),_("div",D,[y("div",N,[(W(!0),_(v,null,w(e.waterfallList,((t,l)=>(W(),_("div",{key:l,class:"vue3-waterfall-item",style:{top:t._top+"px",left:t._left+"px",width:t._width+"px",height:t._height+"px"}},[y("div",B,[x(e.$slots,"default",{item:t},(()=>[y("img",{src:t.imgSrc},null,8,["src"])]),!0)]),y("div",{class:"vue3-waterfall-item_footer",style:{height:e.footerHeight+"px"}},[x(e.$slots,"footer",{item:t},(()=>[y("p",C,L(t.title),1),y("p",$,L(t.info),1)]),!0)],4)],4)))),128))],512),e.isPreloading&&e.list.length<e.total?(W(),_("div",F,[x(e.$slots,"loading",{},(()=>[T]),{})])):b("",!0),e.list.length>=e.total?(W(),_("div",U,[x(e.$slots,"nomore",{},(()=>[k]),{})])):b("",!0)]))));j.render=H,j.__scopeId="data-v-898cf99e";var q=s({name:"App",data:()=>({list:[],total:30}),components:{Waterfall:j},methods:{loadMore(){setTimeout((()=>{this.list=this.list.concat([{id:11,imgSrc:"https://cdn.xnycloud.com/xny-data/_b6314ece09.png",title:"111",info:"222"},{id:12,imgSrc:"https://cdn.xnycloud.com/xny-data/Financing_Clean_Energy_Transitionsin_EMD_Es_World_Energy_Investment_2021_Special_Report_29174d6289.png",title:"111",info:"222"},{id:13,imgSrc:"https://cdn.xnycloud.com/xny-data/2060_df48245eba.png",title:"111",info:"222"}])}),1e3)},loadedEnd(){console.log("图片预加载完成")}},mounted(){setTimeout((()=>{this.list=[{id:1,imgSrc:"https://cdn.xnycloud.com/xny-data/_f26d6f3e95.png",title:"1",info:"222"},{id:2,imgSrc:"https://cdn.xnycloud.com/xny-data/_d53e0ea860.png",title:"6",info:"222"},{id:3,imgSrc:"https://cdn.xnycloud.com/xny-data/_b6314ece09.png",title:"4",info:"222"},{id:4,imgSrc:"https://cdn.xnycloud.com/xny-data/_f26d6f3e95.png",title:"111",info:"222"},{id:5,imgSrc:"https://cdn.xnycloud.com/xny-data/Financing_Clean_Energy_Transitionsin_EMD_Es_World_Energy_Investment_2021_Special_Report_29174d6289.png",title:"111",info:"222"},{id:6,imgSrc:"https://cdn.xnycloud.com/xny-data/Renewable_Power_Generation_Costs_in_2020_614291a015.png",title:"111",info:"222"},{id:7,imgSrc:"https://cdn.xnycloud.com/xny-data/_8fa7009f0b.png",title:"111",info:"222"},{id:8,imgSrc:"https://cdn.xnycloud.com/xny-data/_b6314ece09.png",title:"111",info:"222"},{id:9,imgSrc:"https://cdn.xnycloud.com/xny-data/Financing_Clean_Energy_Transitionsin_EMD_Es_World_Energy_Investment_2021_Special_Report_29174d6289.png",title:"111",info:"222"},{id:10,imgSrc:"https://cdn.xnycloud.com/xny-data/2060_df48245eba.png",title:"111",info:"222"}]}),3e3)}});const z={class:"imgbox"},G=y("span",null,"正在拼命加载中...",-1),V=y("span",null,"没有更多数据了...",-1);q.render=function(e,t,l,o,n,a){const i=I("waterfall");return W(),_(i,{list:e.list,cols:4,footerHeight:0,gap:15,scrollDistance:10,total:e.total,onPreLoaded:e.loadedEnd,onScrollReachBottom:e.loadMore},{default:R((({item:e})=>[y("div",z,[y("img",{src:e.imgSrc,alt:e.title},null,8,["src","alt"])])])),footer:R((({item:e})=>[y("span",null,L(e.id),1)])),loading:R((()=>[G])),nomore:R((()=>[V])),_:1},8,["list","total","onPreLoaded","onScrollReachBottom"])},O(q).mount("#app");
