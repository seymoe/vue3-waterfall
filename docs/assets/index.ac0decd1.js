var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(t,o,l)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[o]=l,a=(e,t)=>{for(var o in t||(t={}))n.call(t,o)&&r(e,o,t[o]);if(l)for(var o of l(t))i.call(t,o)&&r(e,o,t[o]);return e};import{d as s,r as c,a as d,w as m,o as g,b as p,t as f,n as h,c as u,e as _,F as y,f as x,g as b,h as w,i as v,p as E,j as S,k as M,l as P,m as W,q as L,s as R,u as I}from"./vendor.a0fbe6f6.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(o){const l=new URL(e,location),n=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((o,i)=>{const r=new URL(e,l);if(self[t].moduleMap[r])return o(self[t].moduleMap[r]);const a=new Blob([`import * as m from '${r}';`,`${t}.moduleMap['${r}']=m;`],{type:"text/javascript"}),s=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(a),onerror(){i(new Error(`Failed to import: ${e}`)),n(s)},onload(){o(self[t].moduleMap[r]),n(s)}});document.head.appendChild(s)})),self[t].moduleMap={}}}("/vue3-waterfall/assets/");var O=s({name:"VueWaterfall",props:{width:Number,height:Number,colWidth:Number,cols:Number,gap:{type:Number,default:15},footerHeight:{type:Number,default:0},list:{type:Array,default:()=>[]},nomore:{type:Boolean,default:!1},scrollDisabled:{type:Boolean,default:!1},scrollDelay:{type:Number,default:200},scrollDistance:{type:Number,default:0},scrollImmediate:{type:Boolean,default:!0}},setup(e,l){const n=c({containerWidth:e.width||0,colW:e.colWidth||240,colC:e.cols||0,beginIndex:0,heightArr:[],waterfallList:[],isPreloading:!1}),i=d(null),r=()=>{if(!e.width){const e=document.querySelector("#waterfallBox");e&&(n.containerWidth=e.offsetWidth)}if(e.cols?n.colW=Math.floor((n.containerWidth-(e.cols-1)*e.gap)/e.cols):n.colC=Math.floor(n.containerWidth/(n.colW+e.gap)),0===n.beginIndex){n.waterfallList=[],n.heightArr=new Array(n.colC);for(let e=0;e<n.heightArr.length;e++)n.heightArr[e]=0}s()},s=()=>{if(n.isPreloading||!e.list.length)return!1;n.isPreloading=!0;for(let t=n.beginIndex;t<e.list.length;t++){const o=e.list[t];let i=new Image;i.src=o.imgSrc,i.onload=i.onerror=r=>{const a=u();o._width=n.colW,o._height=Math.floor(n.colW*i.height/i.width+e.footerHeight),o._top=n.heightArr[a],o._left=a*(o._width+e.gap),n.heightArr[a]+=o._height+e.gap,n.waterfallList.push(o),"error"===r.type&&(o._error=!0,l.emit("imageError",o)),t===e.list.length-1&&(n.beginIndex=e.list.length,l.emit("preLoaded"),n.isPreloading=!1,e.scrollDisabled||e.scrollImmediate&&y())}}},u=()=>{const e=Math.min.apply(null,n.heightArr);return n.heightArr.indexOf(e)},_=()=>{n.beginIndex=0,r()},y=()=>{if(n.isPreloading||e.nomore)return!1;const t=i.value,o=Math.max.apply(null,n.heightArr);null!==t&&t.scrollTop+t.offsetHeight+e.gap>=o-e.scrollDistance&&(n.isPreloading=!0,l.emit("scrollReachBottom"))};return m((()=>e.list),((e,t)=>{e.length?t&&t.length?t.length!==e.length&&(n.isPreloading=!1,s()):h((()=>{r()})):(n.beginIndex=0,n.isPreloading=!1,r())}),{immediate:!0}),g((()=>{window.addEventListener("resize",_),e.scrollDisabled||null===i.value||i.value.addEventListener("scroll",y)})),p((()=>{window.removeEventListener("resize",_)})),x=a(a({},f(n)),f(e)),t(x,o({scrollElRef:i}));var x}});const j=v();E("data-v-34c9a3d0");const A={class:"vue3-waterfall",id:"waterfallBox"},D={class:"vue3-waterfall-scroller",ref:"scrollElRef"},B={class:"vue3-waterfall-item_image"},C={class:"title"},N={class:"info"},$={key:0,class:"vue3-waterfall-loading"},F=W(" 加载中... "),T={key:1,class:"vue3-waterfall-nomore"},U=W(" 没有更多数据了 ");S();const k=j(((e,t,o,l,n,i)=>(M(),u("div",A,[_("div",D,[(M(!0),u(y,null,x(e.waterfallList,((t,o)=>(M(),u("div",{key:o,class:"vue3-waterfall-item",style:{top:t._top+"px",left:t._left+"px",width:t._width+"px",height:t._height+"px"}},[_("div",B,[b(e.$slots,"default",{item:t},(()=>[_("img",{src:t.imgSrc},null,8,["src"])]),!0)]),_("div",{class:"vue3-waterfall-item_footer",style:{height:e.footerHeight+"px"}},[b(e.$slots,"footer",{item:t},(()=>[_("p",C,P(t.title),1),_("p",N,P(t.info),1)]),!0)],4)],4)))),128))],512),e.isPreloading&&!e.nomore?(M(),u("div",$,[b(e.$slots,"loading",{},(()=>[F]),{})])):w("",!0),e.nomore?(M(),u("div",T,[b(e.$slots,"nomore",{},(()=>[U]),{})])):w("",!0)]))));O.render=k,O.__scopeId="data-v-34c9a3d0";var H=s({name:"App",data:()=>({list:[],noMore:!1}),components:{Waterfall:O},methods:{loadMore(){this.noMore||setTimeout((()=>{this.list=this.list.concat([{id:11,imgSrc:"https://cdn.xnycloud.com/xny-data/_b6314ece09.png",title:"111",info:"222"},{id:12,imgSrc:"https://cdn.xnycloud.com/xny-data/Financing_Clean_Energy_Transitionsin_EMD_Es_World_Energy_Investment_2021_Special_Report_29174d6289.png",title:"111",info:"222"},{id:13,imgSrc:"https://cdn.xnycloud.com/xny-data/2060_df48245eba.png",title:"111",info:"222"}]),this.list.length>=13&&(this.noMore=!0)}),1e3)},loadedEnd(){console.log("图片预加载完成")}},mounted(){setTimeout((()=>{this.list=[{id:1,imgSrc:"https://cdn.xnycloud.com/xny-data/_f26d6f3e95.png",title:"1",info:"222"},{id:2,imgSrc:"https://cdn.xnycloud.com/xny-data/_d53e0ea860.png",title:"6",info:"222"},{id:3,imgSrc:"https://cdn.xnycloud.com/xny-data/_b6314ece09.png",title:"4",info:"222"},{id:4,imgSrc:"https://cdn.xnycloud.com/xny-data/_f26d6f3e95.png",title:"111",info:"222"},{id:5,imgSrc:"https://cdn.xnycloud.com/xny-data/Financing_Clean_Energy_Transitionsin_EMD_Es_World_Energy_Investment_2021_Special_Report_29174d6289.png",title:"111",info:"222"},{id:6,imgSrc:"https://cdn.xnycloud.com/xny-data/Renewable_Power_Generation_Costs_in_2020_614291a015.png",title:"111",info:"222"},{id:7,imgSrc:"https://cdn.xnycloud.com/xny-data/_8fa7009f0b.png",title:"111",info:"222"},{id:8,imgSrc:"https://cdn.xnycloud.com/xny-data/_b6314ece09.png",title:"111",info:"222"},{id:9,imgSrc:"https://cdn.xnycloud.com/xny-data/Financing_Clean_Energy_Transitionsin_EMD_Es_World_Energy_Investment_2021_Special_Report_29174d6289.png",title:"111",info:"222"},{id:10,imgSrc:"https://cdn.xnycloud.com/xny-data/2060_df48245eba.png",title:"111",info:"222"}]}),3e3)}});const q={class:"imgbox"},z=_("span",null,"正在拼命加载中...",-1),G=_("span",null,"没有更多数据了...",-1);H.render=function(e,t,o,l,n,i){const r=R("waterfall");return M(),u(r,{list:e.list,cols:4,footerHeight:0,gap:15,scrollDistance:10,nomore:e.noMore,onPreLoaded:e.loadedEnd,onScrollReachBottom:e.loadMore},{default:L((({item:e})=>[_("div",q,[_("img",{src:e.imgSrc,alt:e.title},null,8,["src","alt"])])])),footer:L((({item:e})=>[_("span",null,P(e.id),1)])),loading:L((()=>[z])),nomore:L((()=>[G])),_:1},8,["list","nomore","onPreLoaded","onScrollReachBottom"])},I(H).mount("#app");
