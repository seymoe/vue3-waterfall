var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,a=(t,l,r)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[l]=r,n=(e,t)=>{for(var l in t||(t={}))o.call(t,l)&&a(e,l,t[l]);if(r)for(var l of r(t))i.call(t,l)&&a(e,l,t[l]);return e};import{defineComponent as s,reactive as d,ref as c,watch as h,nextTick as g,onMounted as f,onUnmounted as p,toRefs as u,pushScopeId as m,popScopeId as v,openBlock as w,createBlock as b,createVNode as y,Fragment as x,renderList as _,renderSlot as P,toDisplayString as W,createCommentVNode as A,withScopeId as I,createTextVNode as O}from"vue";var L=s({name:"VueWaterfall",props:{width:Number,height:Number,colWidth:Number,cols:Number,gap:{type:Number,default:15},footerHeight:{type:Number,default:0},list:{type:Array,default:()=>[]},nomore:{type:Boolean,default:!1},scrollDisabled:{type:Boolean,default:!1},scrollDelay:{type:Number,default:200},scrollDistance:{type:Number,default:0},scrollImmediate:{type:Boolean,default:!0}},setup(e,r){const o=d({containerWidth:e.width||0,colW:e.colWidth||240,colC:e.cols||0,beginIndex:0,heightArr:[],waterfallList:[],isPreloading:!1}),i=c(null),a=()=>{if(!e.width){const e=document.querySelector("#waterfallBox");e&&(o.containerWidth=e.offsetWidth)}if(e.cols?o.colW=Math.floor((o.containerWidth-(e.cols-1)*e.gap)/e.cols):o.colC=Math.floor(o.containerWidth/(o.colW+e.gap)),0===o.beginIndex){o.waterfallList=[],o.heightArr=new Array(o.colC);for(let e=0;e<o.heightArr.length;e++)o.heightArr[e]=0}s()},s=()=>{if(o.isPreloading||!e.list.length)return!1;o.isPreloading=!0;for(let t=o.beginIndex;t<e.list.length;t++){const l=e.list[t];let i=new Image;i.src=l.imgSrc,i.onload=i.onerror=a=>{const n=m();l._width=o.colW,l._height=Math.floor(o.colW*i.height/i.width+e.footerHeight),l._top=o.heightArr[n],l._left=n*(l._width+e.gap),o.heightArr[n]+=l._height+e.gap,o.waterfallList.push(l),"error"===a.type&&(l._error=!0,r.emit("imageError",l)),t===e.list.length-1&&(o.beginIndex=e.list.length,r.emit("preLoaded"),o.isPreloading=!1,e.scrollDisabled||e.scrollImmediate&&w())}}},m=()=>{const e=Math.min.apply(null,o.heightArr);return o.heightArr.indexOf(e)},v=()=>{o.beginIndex=0,a()},w=()=>{if(o.isPreloading||e.nomore)return!1;const t=i.value,l=Math.max.apply(null,o.heightArr);null!==t&&t.scrollTop+t.offsetHeight+e.gap>=l-e.scrollDistance&&(o.isPreloading=!0,r.emit("scrollReachBottom"))};return h((()=>e.list),((e,t)=>{e.length?t&&t.length?t.length!==e.length&&(o.isPreloading=!1,s()):g((()=>{a()})):(o.beginIndex=0,o.isPreloading=!1,a())}),{immediate:!0}),f((()=>{window.addEventListener("resize",v),e.scrollDisabled||null===i.value||i.value.addEventListener("scroll",w)})),p((()=>{window.removeEventListener("resize",v)})),b=n(n({},u(o)),u(e)),t(b,l({scrollElRef:i}));var b}});const N=I("data-v-34c9a3d0");m("data-v-34c9a3d0");const D={class:"vue3-waterfall",id:"waterfallBox"},E={class:"vue3-waterfall-scroller",ref:"scrollElRef"},j={class:"vue3-waterfall-item_image"},B={class:"title"},M={class:"info"},H={key:0,class:"vue3-waterfall-loading"},S=O(" 加载中... "),$={key:1,class:"vue3-waterfall-nomore"},k=O(" 没有更多数据了 ");v();const C=N(((e,t,l,r,o,i)=>(w(),b("div",D,[y("div",E,[(w(!0),b(x,null,_(e.waterfallList,((t,l)=>(w(),b("div",{key:l,class:"vue3-waterfall-item",style:{top:t._top+"px",left:t._left+"px",width:t._width+"px",height:t._height+"px"}},[y("div",j,[P(e.$slots,"default",{item:t},(()=>[y("img",{src:t.imgSrc},null,8,["src"])]),!0)]),y("div",{class:"vue3-waterfall-item_footer",style:{height:e.footerHeight+"px"}},[P(e.$slots,"footer",{item:t},(()=>[y("p",B,W(t.title),1),y("p",M,W(t.info),1)]),!0)],4)],4)))),128))],512),e.isPreloading&&!e.nomore?(w(),b("div",H,[P(e.$slots,"loading",{},(()=>[S]),{},!0)])):A("",!0),e.nomore?(w(),b("div",$,[P(e.$slots,"nomore",{},(()=>[k]),{},!0)])):A("",!0)]))));L.render=C,L.__scopeId="data-v-34c9a3d0";export default L;
