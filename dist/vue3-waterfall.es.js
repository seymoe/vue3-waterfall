var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,a=(t,l,r)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[l]=r,s=(e,t)=>{for(var l in t||(t={}))o.call(t,l)&&a(e,l,t[l]);if(r)for(var l of r(t))i.call(t,l)&&a(e,l,t[l]);return e};import{defineComponent as n,reactive as c,ref as h,watch as d,nextTick as f,onMounted as g,onUnmounted as p,toRefs as u,pushScopeId as m,popScopeId as w,openBlock as b,createBlock as v,createVNode as y,Fragment as x,renderList as _,renderSlot as W,toDisplayString as A,withScopeId as I}from"vue";var O=n({name:"VueWaterfall",props:{width:Number,height:Number,colWidth:Number,cols:Number,gap:{type:Number,default:15},footerHeight:{type:Number,default:0},list:{type:Array,default:()=>[]},scrollDisabled:{type:Boolean,default:!1},scrollDelay:{type:Number,default:200},scrollDistance:{type:Number,default:0},scrollImmediate:{type:Boolean,default:!0}},setup(e,r){const o=c({containerWidth:e.width||0,colW:e.colWidth||240,colC:e.cols||0,beginIndex:0,heightArr:[],waterfallList:[],isPreloading:!1}),i=h(null),a=()=>{if(!e.width){const e=document.querySelector("#waterfallBox");e&&(o.containerWidth=e.offsetWidth)}if(e.cols?o.colW=Math.floor((o.containerWidth-(e.cols-1)*e.gap)/e.cols):o.colC=Math.floor(o.containerWidth/(o.colW+e.gap)),0===o.beginIndex){o.waterfallList=[],o.heightArr=new Array(o.colC);for(let e=0;e<o.heightArr.length;e++)o.heightArr[e]=0}n()},n=()=>{for(let t=o.beginIndex;t<e.list.length;t++){const l=e.list[t];let i=new Image;i.src=l.imgSrc,i.onload=i.onerror=a=>{const s=m();l._width=o.colW,l._height=Math.floor(o.colW*i.height/i.width+e.footerHeight),l._top=o.heightArr[s],l._left=s*(l._width+e.gap),o.heightArr[s]+=l._height,o.waterfallList.push(l),"error"===a.type&&(l._error=!0,r.emit("imageError",l)),t===e.list.length-1&&(o.beginIndex=o.waterfallList.length,r.emit("preLoaded"),o.isPreloading=!1,e.scrollDisabled||e.scrollImmediate&&b())}}},m=()=>{const e=Math.min.apply(null,o.heightArr);return o.heightArr.indexOf(e)},w=()=>{o.beginIndex=0,a()},b=()=>{if(o.isPreloading)return!1;const t=i.value,l=Math.max.apply(null,o.heightArr);null!==t&&t.scrollTop+t.offsetHeight>=l-e.scrollDistance&&(o.isPreloading=!0,r.emit("scrollReachBottom"))};return d((()=>e.list),((e,t)=>{!t||!t.length&&e.length?f((()=>{a()})):t.length!==e.length&&n()}),{immediate:!0}),g((()=>{window.addEventListener("resize",w),e.scrollDisabled||null===i.value||i.value.addEventListener("scroll",b)})),p((()=>{window.removeEventListener("resize",w)})),v=s(s({},u(o)),u(e)),t(v,l({scrollElRef:i}));var v}});const L=I("data-v-79cde026");m("data-v-79cde026");const P={class:"vue3-waterfall",id:"waterfallBox"},N={class:"vue3-waterfall-scroller",ref:"scrollElRef"},D={class:"title"},E={class:"info"};w();const j=L(((e,t,l,r,o,i)=>(b(),v("div",P,[y("div",N,[(b(!0),v(x,null,_(e.waterfallList,((t,l)=>(b(),v("div",{key:l,class:"vue3-waterfall-item",style:{top:t._top+"px",left:t._left+"px",width:t._width+"px",height:t._height+"px"}},[W(e.$slots,"default",{item:t},(()=>[y("img",{src:t.imgSrc,alt:t.title},null,8,["src","alt"])]),!0),y("div",{class:"vue3-waterfall-item_footer",style:{height:e.footerHeight+"px"}},[W(e.$slots,"footer",{item:t},(()=>[y("p",D,A(t.title),1),y("p",E,A(t.info),1)]),!0)],4)],4)))),128))],512)]))));O.render=j,O.__scopeId="data-v-79cde026";export default O;
