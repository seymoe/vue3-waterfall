var e=Object.defineProperty,l=Object.defineProperties,t=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,a=(l,t,r)=>t in l?e(l,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[t]=r,s=(e,l)=>{for(var t in l||(l={}))o.call(l,t)&&a(e,t,l[t]);if(r)for(var t of r(l))i.call(l,t)&&a(e,t,l[t]);return e};import{defineComponent as n,reactive as c,ref as d,watch as g,nextTick as h,onMounted as f,onUnmounted as p,toRefs as u,pushScopeId as m,popScopeId as w,openBlock as v,createBlock as b,createVNode as y,Fragment as x,renderList as _,renderSlot as P,toDisplayString as W,createCommentVNode as I,withScopeId as A,createTextVNode as L}from"vue";var O=n({name:"VueWaterfall",props:{width:Number,height:Number,colWidth:Number,cols:Number,gap:{type:Number,default:15},footerHeight:{type:Number,default:0},list:{type:Array,default:()=>[]},scrollDisabled:{type:Boolean,default:!1},scrollDelay:{type:Number,default:200},scrollDistance:{type:Number,default:0},scrollImmediate:{type:Boolean,default:!0}},setup(e,r){const o=c({containerWidth:e.width||0,colW:e.colWidth||240,colC:e.cols||0,beginIndex:0,heightArr:[],waterfallList:[],isPreloading:!1}),i=d(null),a=()=>{if(!e.width){const e=document.querySelector("#waterfallBox");e&&(o.containerWidth=e.offsetWidth)}if(e.cols?o.colW=Math.floor((o.containerWidth-(e.cols-1)*e.gap)/e.cols):o.colC=Math.floor(o.containerWidth/(o.colW+e.gap)),0===o.beginIndex){o.waterfallList=[],o.heightArr=new Array(o.colC);for(let e=0;e<o.heightArr.length;e++)o.heightArr[e]=0}n()},n=()=>{if(console.log("当前索引：",o),o.isPreloading||!e.list.length)return!1;o.isPreloading=!0;for(let l=o.beginIndex;l<e.list.length;l++){const t=e.list[l];let i=new Image;i.src=t.imgSrc,i.onload=i.onerror=a=>{const s=m();t._width=o.colW,t._height=Math.floor(o.colW*i.height/i.width+e.footerHeight),t._top=o.heightArr[s],t._left=s*(t._width+e.gap),o.heightArr[s]+=t._height+e.gap,o.waterfallList.push(t),"error"===a.type&&(t._error=!0,r.emit("imageError",t)),console.log("i:",l,o.beginIndex,o.waterfallList),l===e.list.length-1&&(o.beginIndex=o.waterfallList.length,r.emit("preLoaded"),o.isPreloading=!1,e.scrollDisabled||e.scrollImmediate&&v())}}},m=()=>{const e=Math.min.apply(null,o.heightArr);return o.heightArr.indexOf(e)},w=()=>{o.beginIndex=0,a()},v=()=>{if(o.isPreloading)return!1;const l=i.value,t=Math.max.apply(null,o.heightArr);null!==l&&console.log((null==l?void 0:l.scrollTop)+(null==l?void 0:l.offsetHeight)+e.gap,t-e.scrollDistance),null!==l&&l.scrollTop+l.offsetHeight+e.gap>=t-e.scrollDistance&&(o.isPreloading=!0,r.emit("scrollReachBottom"),console.log("触底"))};return g((()=>e.list),((e,l)=>{console.log("变动",e,l),e.length?l&&l.length?l.length!==e.length&&(o.isPreloading=!1,n()):h((()=>{a()})):(o.beginIndex=0,o.isPreloading=!1,a())}),{immediate:!0}),f((()=>{window.addEventListener("resize",w),e.scrollDisabled||null===i.value||i.value.addEventListener("scroll",v)})),p((()=>{window.removeEventListener("resize",w)})),b=s(s({},u(o)),u(e)),l(b,t({scrollElRef:i}));var b}});const D=A("data-v-08a8f40c");m("data-v-08a8f40c");const N={class:"vue3-waterfall",id:"waterfallBox"},E={class:"vue3-waterfall-scroller",ref:"scrollElRef"},j={class:"vue3-waterfall-item_image"},B={class:"title"},H={class:"info"},M={key:0,class:"vue3-waterfall-loading"},S=L(" 加载中... ");w();const C=D(((e,l,t,r,o,i)=>(v(),b("div",N,[y("div",E,[(v(!0),b(x,null,_(e.waterfallList,((l,t)=>(v(),b("div",{key:t,class:"vue3-waterfall-item",style:{top:l._top+"px",left:l._left+"px",width:l._width+"px",height:l._height+"px"}},[y("div",j,[P(e.$slots,"default",{item:l},(()=>[y("img",{src:l.imgSrc},null,8,["src"])]),!0)]),y("div",{class:"vue3-waterfall-item_footer",style:{height:e.footerHeight+"px"}},[P(e.$slots,"footer",{item:l},(()=>[y("p",B,W(l.title),1),y("p",H,W(l.info),1)]),!0)],4)],4)))),128))],512),e.isPreloading?(v(),b("div",M,[P(e.$slots,"loading",{},(()=>[S]),{},!0)])):I("",!0)]))));O.render=C,O.__scopeId="data-v-08a8f40c";export default O;
