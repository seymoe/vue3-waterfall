var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,a=(t,l,r)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[l]=r,s=(e,t)=>{for(var l in t||(t={}))i.call(t,l)&&a(e,l,t[l]);if(r)for(var l of r(t))o.call(t,l)&&a(e,l,t[l]);return e};import{defineComponent as n,reactive as d,ref as c,watch as h,nextTick as g,onMounted as f,onUnmounted as p,toRefs as u,pushScopeId as m,popScopeId as w,openBlock as v,createBlock as b,createVNode as y,Fragment as x,renderList as _,renderSlot as P,toDisplayString as W,createCommentVNode as A,withScopeId as I,createTextVNode as O}from"vue";var L=n({name:"VueWaterfall",props:{width:Number,height:Number,colWidth:Number,cols:Number,gap:{type:Number,default:15},footerHeight:{type:Number,default:0},list:{type:Array,default:()=>[]},scrollDisabled:{type:Boolean,default:!1},scrollDelay:{type:Number,default:200},scrollDistance:{type:Number,default:0},scrollImmediate:{type:Boolean,default:!0}},setup(e,r){const i=d({containerWidth:e.width||0,colW:e.colWidth||240,colC:e.cols||0,beginIndex:0,heightArr:[],waterfallList:[],isPreloading:!1}),o=c(null),a=()=>{if(!e.width){const e=document.querySelector("#waterfallBox");e&&(i.containerWidth=e.offsetWidth)}if(e.cols?i.colW=Math.floor((i.containerWidth-(e.cols-1)*e.gap)/e.cols):i.colC=Math.floor(i.containerWidth/(i.colW+e.gap)),0===i.beginIndex){i.waterfallList=[],i.heightArr=new Array(i.colC);for(let e=0;e<i.heightArr.length;e++)i.heightArr[e]=0}n()},n=()=>{if(i.isPreloading||!e.list.length)return!1;i.isPreloading=!0;for(let t=i.beginIndex;t<e.list.length;t++){const l=e.list[t];let o=new Image;o.src=l.imgSrc,o.onload=o.onerror=a=>{const s=m();l._width=i.colW,l._height=Math.floor(i.colW*o.height/o.width+e.footerHeight),l._top=i.heightArr[s],l._left=s*(l._width+e.gap),i.heightArr[s]+=l._height+e.gap,i.waterfallList.push(l),"error"===a.type&&(l._error=!0,r.emit("imageError",l)),t===e.list.length-1&&(i.beginIndex=i.waterfallList.length,r.emit("preLoaded"),i.isPreloading=!1,e.scrollDisabled||e.scrollImmediate&&v())}}},m=()=>{const e=Math.min.apply(null,i.heightArr);return i.heightArr.indexOf(e)},w=()=>{i.beginIndex=0,a()},v=()=>{if(i.isPreloading)return!1;const t=o.value,l=Math.max.apply(null,i.heightArr);null!==t&&t.scrollTop+t.offsetHeight+e.gap>=l-e.scrollDistance&&(i.isPreloading=!0,r.emit("scrollReachBottom"))};return h((()=>e.list),((e,t)=>{e.length?t&&t.length?t.length!==e.length&&(i.isPreloading=!1,n()):g((()=>{a()})):(i.beginIndex=0,i.isPreloading=!1,a())}),{immediate:!0}),f((()=>{window.addEventListener("resize",w),e.scrollDisabled||null===o.value||o.value.addEventListener("scroll",v)})),p((()=>{window.removeEventListener("resize",w)})),b=s(s({},u(i)),u(e)),t(b,l({scrollElRef:o}));var b}});const N=I("data-v-a68501e6");m("data-v-a68501e6");const D={class:"vue3-waterfall",id:"waterfallBox"},E={class:"vue3-waterfall-scroller",ref:"scrollElRef"},j={class:"vue3-waterfall-item_image"},B={class:"title"},M={class:"info"},H={key:0,class:"vue3-waterfall-loading"},S=O(" 加载中... ");w();const C=N(((e,t,l,r,i,o)=>(v(),b("div",D,[y("div",E,[(v(!0),b(x,null,_(e.waterfallList,((t,l)=>(v(),b("div",{key:l,class:"vue3-waterfall-item",style:{top:t._top+"px",left:t._left+"px",width:t._width+"px",height:t._height+"px"}},[y("div",j,[P(e.$slots,"default",{item:t},(()=>[y("img",{src:t.imgSrc},null,8,["src"])]),!0)]),y("div",{class:"vue3-waterfall-item_footer",style:{height:e.footerHeight+"px"}},[P(e.$slots,"footer",{item:t},(()=>[y("p",B,W(t.title),1),y("p",M,W(t.info),1)]),!0)],4)],4)))),128))],512),e.isPreloading?(v(),b("div",H,[P(e.$slots,"loading",{},(()=>[S]),{},!0)])):A("",!0)]))));L.render=C,L.__scopeId="data-v-a68501e6";export default L;
