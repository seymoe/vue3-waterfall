var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,a=(t,l,r)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[l]=r,s=(e,t)=>{for(var l in t||(t={}))i.call(t,l)&&a(e,l,t[l]);if(r)for(var l of r(t))o.call(t,l)&&a(e,l,t[l]);return e};import{defineComponent as n,reactive as c,ref as h,watch as d,nextTick as f,onMounted as g,onUnmounted as p,toRefs as u,pushScopeId as m,popScopeId as b,openBlock as w,createBlock as v,createVNode as y,Fragment as x,renderList as _,renderSlot as W,toDisplayString as A,withScopeId as I}from"vue";var O=n({name:"VueWaterfall",props:{width:Number,height:Number,colWidth:Number,cols:Number,gap:{type:Number,default:15},footerHeight:{type:Number,default:0},list:{type:Array,default:()=>[]},scrollDisabled:{type:Boolean,default:!1},scrollDelay:{type:Number,default:200},scrollDistance:{type:Number,default:0},scrollImmediate:{type:Boolean,default:!0}},setup(e,r){const i=c({containerWidth:e.width||0,colW:e.colWidth||240,colC:e.cols||0,beginIndex:0,heightArr:[],waterfallList:[],isPreloading:!1}),o=h(null),a=()=>{if(!e.width){const e=document.querySelector("#waterfallBox");e&&(i.containerWidth=e.offsetWidth)}if(e.cols?i.colW=Math.floor((i.containerWidth-(e.cols-1)*e.gap)/e.cols):i.colC=Math.floor(i.containerWidth/(i.colW+e.gap)),0===i.beginIndex){i.waterfallList=[],i.heightArr=new Array(i.colC);for(let e=0;e<i.heightArr.length;e++)i.heightArr[e]=0}n()},n=()=>{for(let t=i.beginIndex;t<e.list.length;t++){const l=e.list[t];let o=new Image;o.src=l.imgSrc,o.onload=o.onerror=a=>{const s=m();l._width=i.colW,l._height=Math.floor(i.colW*o.height/o.width+e.footerHeight),l._top=i.heightArr[s],l._left=s*(l._width+e.gap),i.heightArr[s]+=l._height+e.gap,i.waterfallList.push(l),"error"===a.type&&(l._error=!0,r.emit("imageError",l)),t===e.list.length-1&&(i.beginIndex=i.waterfallList.length,r.emit("preLoaded"),i.isPreloading=!1,e.scrollDisabled||e.scrollImmediate&&w())}}},m=()=>{const e=Math.min.apply(null,i.heightArr);return i.heightArr.indexOf(e)},b=()=>{i.beginIndex=0,a()},w=()=>{if(i.isPreloading)return!1;const t=o.value,l=Math.max.apply(null,i.heightArr);null!==t&&t.scrollTop+t.offsetHeight+e.gap>=l-e.scrollDistance&&(i.isPreloading=!0,r.emit("scrollReachBottom"))};return d((()=>e.list),((e,t)=>{e.length?t&&t.length?t.length!==e.length&&n():f((()=>{a()})):(i.beginIndex=0,a())}),{immediate:!0}),g((()=>{window.addEventListener("resize",b),e.scrollDisabled||null===o.value||o.value.addEventListener("scroll",w)})),p((()=>{window.removeEventListener("resize",b)})),v=s(s({},u(i)),u(e)),t(v,l({scrollElRef:o}));var v}});const L=I("data-v-3733b098");m("data-v-3733b098");const P={class:"vue3-waterfall",id:"waterfallBox"},N={class:"vue3-waterfall-scroller",ref:"scrollElRef"},D={class:"vue3-waterfall-item_image"},E={class:"title"},j={class:"info"};b();const B=L(((e,t,l,r,i,o)=>(w(),v("div",P,[y("div",N,[(w(!0),v(x,null,_(e.waterfallList,((t,l)=>(w(),v("div",{key:l,class:"vue3-waterfall-item",style:{top:t._top+"px",left:t._left+"px",width:t._width+"px",height:t._height+"px"}},[y("div",D,[W(e.$slots,"default",{item:t},(()=>[y("img",{src:t.imgSrc},null,8,["src"])]),!0)]),y("div",{class:"vue3-waterfall-item_footer",style:{height:e.footerHeight+"px"}},[W(e.$slots,"footer",{item:t},(()=>[y("p",E,A(t.title),1),y("p",j,A(t.info),1)]),!0)],4)],4)))),128))],512)]))));O.render=B,O.__scopeId="data-v-3733b098";export default O;
