var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,a=(t,l,r)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[l]=r,s=(e,t)=>{for(var l in t||(t={}))o.call(t,l)&&a(e,l,t[l]);if(r)for(var l of r(t))i.call(t,l)&&a(e,l,t[l]);return e};import{defineComponent as n,reactive as c,ref as d,computed as h,watch as g,nextTick as f,onMounted as u,onUnmounted as p,toRefs as m,pushScopeId as v,popScopeId as w,openBlock as b,createBlock as y,createVNode as x,Fragment as _,renderList as P,renderSlot as W,toDisplayString as A,createCommentVNode as I,withScopeId as O,createTextVNode as N}from"vue";var L=n({name:"VueWaterfall",props:{width:Number,height:Number,colWidth:Number,cols:Number,gap:{type:Number,default:15},footerHeight:{type:Number,default:0},list:{type:Array,default:()=>[]},total:{type:Number,default:0},scrollDisabled:{type:Boolean,default:!1},scrollDelay:{type:Number,default:200},scrollDistance:{type:Number,default:0},scrollImmediate:{type:Boolean,default:!0}},setup(e,r){const o=c({containerWidth:e.width||0,colW:e.colWidth||240,colC:e.cols||0,beginIndex:0,heightArr:[],waterfallList:[],isPreloading:!1}),i=d(null),a=h((()=>e.list.length>=e.total)),n=()=>{if(!e.width){const e=document.querySelector("#waterfallBox");e&&(o.containerWidth=e.offsetWidth)}if(e.cols?o.colW=Math.floor((o.containerWidth-(e.cols-1)*e.gap)/e.cols):o.colC=Math.floor(o.containerWidth/(o.colW+e.gap)),0===o.beginIndex){o.waterfallList=[],o.heightArr=new Array(o.colC);for(let e=0;e<o.heightArr.length;e++)o.heightArr[e]=0}v()},v=()=>{if(console.log(o,e,a.value),o.isPreloading||!e.list.length||a.value)return!1;o.isPreloading=!0;for(let t=o.beginIndex;t<e.list.length;t++){const l=e.list[t];let i=new Image;i.src=l.imgSrc,i.onload=i.onerror=a=>{const s=w();l._width=o.colW,l._height=Math.floor(o.colW*i.height/i.width+e.footerHeight),l._top=o.heightArr[s],l._left=s*(l._width+e.gap),o.heightArr[s]+=l._height+e.gap,o.waterfallList.push(l),"error"===a.type&&(l._error=!0,r.emit("imageError",l)),t===e.list.length-1&&(o.beginIndex=e.list.length,r.emit("preLoaded"),o.isPreloading=!1,e.scrollDisabled||e.scrollImmediate&&y())}}},w=()=>{const e=Math.min.apply(null,o.heightArr);return o.heightArr.indexOf(e)},b=()=>{o.beginIndex=0,n()},y=()=>{if(o.isPreloading||a.value)return!1;const t=i.value,l=Math.max.apply(null,o.heightArr);null!==t&&t.scrollTop+t.offsetHeight+e.gap>=l-e.scrollDistance&&(o.isPreloading=!0,r.emit("scrollReachBottom"))};return g((()=>e.list),((e,t)=>{e.length?t&&t.length?t.length!==e.length&&(o.isPreloading=!1,v()):(console.log("watch了！ ",e,t),f((()=>{n()}))):(o.beginIndex=0,o.isPreloading=!1,n())}),{immediate:!0}),u((()=>{window.addEventListener("resize",b),e.scrollDisabled||null===i.value||i.value.addEventListener("scroll",y)})),p((()=>{window.removeEventListener("resize",b)})),x=s(s({},m(o)),m(e)),t(x,l({scrollElRef:i}));var x}});const D=O("data-v-898cf99e");v("data-v-898cf99e");const E={class:"vue3-waterfall",id:"waterfallBox"},j={class:"vue3-waterfall-scroller",ref:"scrollElRef"},B={class:"vue3-waterfall-item_image"},M={class:"title"},H={class:"info"},S={key:0,class:"vue3-waterfall-loading"},$=N(" 加载中... "),k={key:1,class:"vue3-waterfall-nomore"},C=N(" 没有更多数据了 ");w();const R=D(((e,t,l,r,o,i)=>(b(),y("div",E,[x("div",j,[(b(!0),y(_,null,P(e.waterfallList,((t,l)=>(b(),y("div",{key:l,class:"vue3-waterfall-item",style:{top:t._top+"px",left:t._left+"px",width:t._width+"px",height:t._height+"px"}},[x("div",B,[W(e.$slots,"default",{item:t},(()=>[x("img",{src:t.imgSrc},null,8,["src"])]),!0)]),x("div",{class:"vue3-waterfall-item_footer",style:{height:e.footerHeight+"px"}},[W(e.$slots,"footer",{item:t},(()=>[x("p",M,A(t.title),1),x("p",H,A(t.info),1)]),!0)],4)],4)))),128))],512),e.isPreloading&&e.list.length<e.total?(b(),y("div",S,[W(e.$slots,"loading",{},(()=>[$]),{},!0)])):I("",!0),e.list.length>=e.total?(b(),y("div",k,[W(e.$slots,"nomore",{},(()=>[C]),{},!0)])):I("",!0)]))));L.render=R,L.__scopeId="data-v-898cf99e";export default L;
