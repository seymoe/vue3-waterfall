var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,r)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))__hasOwnProp.call(t,r)&&__defNormalProp(e,r,t[r]);if(__getOwnPropSymbols)for(var r of __getOwnPropSymbols(t))__propIsEnum.call(t,r)&&__defNormalProp(e,r,t[r]);return e},__spreadProps=(e,t)=>__defProps(e,__getOwnPropDescs(t));!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("vue")):"function"==typeof define&&define.amd?define(["vue"],t):(e="undefined"!=typeof globalThis?globalThis:e||self)["vue3-waterfall"]=t(e.Vue)}(this,(function(e){"use strict";var t=e.defineComponent({name:"VueWaterfall",props:{width:Number,height:Number,colWidth:Number,cols:Number,gap:{type:Number,default:15},footerHeight:{type:Number,default:0},list:{type:Array,default:()=>[]},scrollDisabled:{type:Boolean,default:!1},scrollDelay:{type:Number,default:200},scrollDistance:{type:Number,default:0},scrollImmediate:{type:Boolean,default:!0}},setup(t,r){const l=e.reactive({containerWidth:t.width||0,colW:t.colWidth||240,colC:t.cols||0,beginIndex:0,heightArr:[],waterfallList:[],isPreloading:!1}),o=e.ref(null),i=()=>{if(!t.width){const e=document.querySelector("#waterfallBox");e&&(l.containerWidth=e.offsetWidth)}if(t.cols?l.colW=Math.floor((l.containerWidth-(t.cols-1)*t.gap)/t.cols):l.colC=Math.floor(l.containerWidth/(l.colW+t.gap)),0===l.beginIndex){l.waterfallList=[],l.heightArr=new Array(l.colC);for(let e=0;e<l.heightArr.length;e++)l.heightArr[e]=0}a()},a=()=>{if(l.isPreloading||!t.list.length)return!1;l.isPreloading=!0;for(let e=l.beginIndex;e<t.list.length;e++){const o=t.list[e];let i=new Image;i.src=o.imgSrc,i.onload=i.onerror=a=>{const s=n();o._width=l.colW,o._height=Math.floor(l.colW*i.height/i.width+t.footerHeight),o._top=l.heightArr[s],o._left=s*(o._width+t.gap),l.heightArr[s]+=o._height+t.gap,l.waterfallList.push(o),"error"===a.type&&(o._error=!0,r.emit("imageError",o)),e===t.list.length-1&&(l.beginIndex=t.list.length,r.emit("preLoaded"),l.isPreloading=!1,t.scrollDisabled||t.scrollImmediate&&d())}}},n=()=>{const e=Math.min.apply(null,l.heightArr);return l.heightArr.indexOf(e)},s=()=>{l.beginIndex=0,i()},d=()=>{if(l.isPreloading)return!1;const e=o.value,i=Math.max.apply(null,l.heightArr);null!==e&&e.scrollTop+e.offsetHeight+t.gap>=i-t.scrollDistance&&(l.isPreloading=!0,r.emit("scrollReachBottom"))};return e.watch((()=>t.list),((t,r)=>{t.length?r&&r.length?r.length!==t.length&&(l.isPreloading=!1,a()):(console.log("watch了！ ",t,r),e.nextTick((()=>{i()}))):(l.beginIndex=0,l.isPreloading=!1,i())}),{immediate:!0}),e.onMounted((()=>{window.addEventListener("resize",s),t.scrollDisabled||null===o.value||o.value.addEventListener("scroll",d)})),e.onUnmounted((()=>{window.removeEventListener("resize",s)})),__spreadProps(__spreadValues(__spreadValues({},e.toRefs(l)),e.toRefs(t)),{scrollElRef:o})}});const r=e.withScopeId("data-v-03f14f6f");e.pushScopeId("data-v-03f14f6f");const l={class:"vue3-waterfall",id:"waterfallBox"},o={class:"vue3-waterfall-scroller",ref:"scrollElRef"},i={class:"vue3-waterfall-item_image"},a={class:"title"},n={class:"info"},s={key:0,class:"vue3-waterfall-loading"},d=e.createTextVNode(" 加载中... ");e.popScopeId();const c=r(((t,r,c,p,f,h)=>(e.openBlock(),e.createBlock("div",l,[e.createVNode("div",o,[(e.openBlock(!0),e.createBlock(e.Fragment,null,e.renderList(t.waterfallList,((r,l)=>(e.openBlock(),e.createBlock("div",{key:l,class:"vue3-waterfall-item",style:{top:r._top+"px",left:r._left+"px",width:r._width+"px",height:r._height+"px"}},[e.createVNode("div",i,[e.renderSlot(t.$slots,"default",{item:r},(()=>[e.createVNode("img",{src:r.imgSrc},null,8,["src"])]),!0)]),e.createVNode("div",{class:"vue3-waterfall-item_footer",style:{height:t.footerHeight+"px"}},[e.renderSlot(t.$slots,"footer",{item:r},(()=>[e.createVNode("p",a,e.toDisplayString(r.title),1),e.createVNode("p",n,e.toDisplayString(r.info),1)]),!0)],4)],4)))),128))],512),t.isPreloading?(e.openBlock(),e.createBlock("div",s,[e.renderSlot(t.$slots,"loading",{},(()=>[d]),{},!0)])):e.createCommentVNode("",!0)]))));return t.render=c,t.__scopeId="data-v-03f14f6f",t}));
