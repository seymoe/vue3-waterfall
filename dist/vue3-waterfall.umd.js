var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,o)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,__spreadValues=(e,t)=>{for(var o in t||(t={}))__hasOwnProp.call(t,o)&&__defNormalProp(e,o,t[o]);if(__getOwnPropSymbols)for(var o of __getOwnPropSymbols(t))__propIsEnum.call(t,o)&&__defNormalProp(e,o,t[o]);return e},__spreadProps=(e,t)=>__defProps(e,__getOwnPropDescs(t));!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("vue")):"function"==typeof define&&define.amd?define(["vue"],t):(e="undefined"!=typeof globalThis?globalThis:e||self)["vue3-waterfall"]=t(e.Vue)}(this,(function(e){"use strict";var t=e.defineComponent({name:"VueWaterfall",props:{width:Number,height:Number,colWidth:Number,cols:Number,gap:{type:Number,default:15},footerHeight:{type:Number,default:0},list:{type:Array,default:()=>[]},nomore:{type:Boolean,default:!1},scrollDisabled:{type:Boolean,default:!1},scrollDelay:{type:Number,default:200},scrollDistance:{type:Number,default:0},scrollImmediate:{type:Boolean,default:!0}},setup(t,o){const r=e.reactive({containerWidth:t.width||0,colW:t.colWidth||240,colC:t.cols||0,beginIndex:0,heightArr:[],waterfallList:[],isPreloading:!1}),l=e.ref(null),a=()=>{if(!t.width){const e=document.querySelector("#waterfallBox");e&&(r.containerWidth=e.offsetWidth)}if(t.cols?r.colW=Math.floor((r.containerWidth-(t.cols-1)*t.gap)/t.cols):r.colC=Math.floor(r.containerWidth/(r.colW+t.gap)),0===r.beginIndex){r.waterfallList=[],r.heightArr=new Array(r.colC);for(let e=0;e<r.heightArr.length;e++)r.heightArr[e]=0}i()},i=()=>{if(r.isPreloading||!t.list.length)return!1;r.isPreloading=!0;for(let e=r.beginIndex;e<t.list.length;e++){const l=t.list[e];let a=new Image;a.src=l.imgSrc,a.onload=a.onerror=i=>{const s=n();l._width=r.colW,l._height=Math.floor(r.colW*a.height/a.width+t.footerHeight),l._top=r.heightArr[s],l._left=s*(l._width+t.gap),r.heightArr[s]+=l._height+t.gap,r.waterfallList.push(l),"error"===i.type&&(l._error=!0,o.emit("imageError",l)),e===t.list.length-1&&(r.beginIndex=t.list.length,o.emit("preLoaded"),r.isPreloading=!1,t.scrollDisabled||t.scrollImmediate&&d())}}},n=()=>{const e=Math.min.apply(null,r.heightArr);return r.heightArr.indexOf(e)},s=()=>{r.beginIndex=0,a()},d=()=>{if(r.isPreloading||t.nomore)return!1;const e=l.value,a=Math.max.apply(null,r.heightArr);null!==e&&e.scrollTop+e.offsetHeight+t.gap>=a-t.scrollDistance&&(r.isPreloading=!0,o.emit("scrollReachBottom"))};return e.watch((()=>t.list),((t,o)=>{t.length?o&&o.length?o.length!==t.length&&(r.isPreloading=!1,i()):e.nextTick((()=>{a()})):(r.beginIndex=0,r.isPreloading=!1,a())}),{immediate:!0}),e.onMounted((()=>{window.addEventListener("resize",s),t.scrollDisabled||null===l.value||l.value.addEventListener("scroll",d)})),e.onUnmounted((()=>{window.removeEventListener("resize",s)})),__spreadProps(__spreadValues(__spreadValues({},e.toRefs(r)),e.toRefs(t)),{scrollElRef:l})}});const o=e.withScopeId("data-v-34c9a3d0");e.pushScopeId("data-v-34c9a3d0");const r={class:"vue3-waterfall",id:"waterfallBox"},l={class:"vue3-waterfall-scroller",ref:"scrollElRef"},a={class:"vue3-waterfall-item_image"},i={class:"title"},n={class:"info"},s={key:0,class:"vue3-waterfall-loading"},d=e.createTextVNode(" 加载中... "),c={key:1,class:"vue3-waterfall-nomore"},p=e.createTextVNode(" 没有更多数据了 ");e.popScopeId();const f=o(((t,o,f,h,g,u)=>(e.openBlock(),e.createBlock("div",r,[e.createVNode("div",l,[(e.openBlock(!0),e.createBlock(e.Fragment,null,e.renderList(t.waterfallList,((o,r)=>(e.openBlock(),e.createBlock("div",{key:r,class:"vue3-waterfall-item",style:{top:o._top+"px",left:o._left+"px",width:o._width+"px",height:o._height+"px"}},[e.createVNode("div",a,[e.renderSlot(t.$slots,"default",{item:o},(()=>[e.createVNode("img",{src:o.imgSrc},null,8,["src"])]),!0)]),e.createVNode("div",{class:"vue3-waterfall-item_footer",style:{height:t.footerHeight+"px"}},[e.renderSlot(t.$slots,"footer",{item:o},(()=>[e.createVNode("p",i,e.toDisplayString(o.title),1),e.createVNode("p",n,e.toDisplayString(o.info),1)]),!0)],4)],4)))),128))],512),t.isPreloading&&!t.nomore?(e.openBlock(),e.createBlock("div",s,[e.renderSlot(t.$slots,"loading",{},(()=>[d]),{},!0)])):e.createCommentVNode("",!0),t.nomore?(e.openBlock(),e.createBlock("div",c,[e.renderSlot(t.$slots,"nomore",{},(()=>[p]),{},!0)])):e.createCommentVNode("",!0)]))));return t.render=f,t.__scopeId="data-v-34c9a3d0",t}));
