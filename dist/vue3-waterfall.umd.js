var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,l)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l,__spreadValues=(e,t)=>{for(var l in t||(t={}))__hasOwnProp.call(t,l)&&__defNormalProp(e,l,t[l]);if(__getOwnPropSymbols)for(var l of __getOwnPropSymbols(t))__propIsEnum.call(t,l)&&__defNormalProp(e,l,t[l]);return e},__spreadProps=(e,t)=>__defProps(e,__getOwnPropDescs(t));!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("vue")):"function"==typeof define&&define.amd?define(["vue"],t):(e="undefined"!=typeof globalThis?globalThis:e||self)["vue3-waterfall"]=t(e.Vue)}(this,(function(e){"use strict";var t=e.defineComponent({name:"VueWaterfall",props:{width:Number,height:Number,colWidth:Number,cols:Number,gap:{type:Number,default:15},footerHeight:{type:Number,default:0},list:{type:Array,default:()=>[]},scrollDisabled:{type:Boolean,default:!1},scrollDelay:{type:Number,default:200},scrollDistance:{type:Number,default:0},scrollImmediate:{type:Boolean,default:!0}},setup(t,l){const o=e.reactive({containerWidth:t.width||0,colW:t.colWidth||240,colC:t.cols||0,beginIndex:0,heightArr:[],waterfallList:[],isPreloading:!1}),r=e.ref(null),i=()=>{if(!t.width){const e=document.querySelector("#waterfallBox");e&&(o.containerWidth=e.offsetWidth)}if(t.cols?o.colW=Math.floor((o.containerWidth-(t.cols-1)*t.gap)/t.cols):o.colC=Math.floor(o.containerWidth/(o.colW+t.gap)),0===o.beginIndex){o.waterfallList=[],o.heightArr=new Array(o.colC);for(let e=0;e<o.heightArr.length;e++)o.heightArr[e]=0}a()},a=()=>{if(console.log("当前索引：",o),o.isPreloading||!t.list.length)return!1;o.isPreloading=!0;for(let e=o.beginIndex;e<t.list.length;e++){const r=t.list[e];let i=new Image;i.src=r.imgSrc,i.onload=i.onerror=a=>{const s=n();r._width=o.colW,r._height=Math.floor(o.colW*i.height/i.width+t.footerHeight),r._top=o.heightArr[s],r._left=s*(r._width+t.gap),o.heightArr[s]+=r._height+t.gap,o.waterfallList.push(r),"error"===a.type&&(r._error=!0,l.emit("imageError",r)),console.log("i:",e,o.beginIndex,o.waterfallList),e===t.list.length-1&&(o.beginIndex=o.waterfallList.length,l.emit("preLoaded"),o.isPreloading=!1,t.scrollDisabled||t.scrollImmediate&&c())}}},n=()=>{const e=Math.min.apply(null,o.heightArr);return o.heightArr.indexOf(e)},s=()=>{o.beginIndex=0,i()},c=()=>{if(o.isPreloading)return!1;const e=r.value,i=Math.max.apply(null,o.heightArr);null!==e&&console.log((null==e?void 0:e.scrollTop)+(null==e?void 0:e.offsetHeight)+t.gap,i-t.scrollDistance),null!==e&&e.scrollTop+e.offsetHeight+t.gap>=i-t.scrollDistance&&(o.isPreloading=!0,l.emit("scrollReachBottom"),console.log("触底"))};return e.watch((()=>t.list),((t,l)=>{console.log("变动",t,l),t.length?l&&l.length?l.length!==t.length&&(o.isPreloading=!1,a()):e.nextTick((()=>{i()})):(o.beginIndex=0,o.isPreloading=!1,i())}),{immediate:!0}),e.onMounted((()=>{window.addEventListener("resize",s),t.scrollDisabled||null===r.value||r.value.addEventListener("scroll",c)})),e.onUnmounted((()=>{window.removeEventListener("resize",s)})),__spreadProps(__spreadValues(__spreadValues({},e.toRefs(o)),e.toRefs(t)),{scrollElRef:r})}});const l=e.withScopeId("data-v-08a8f40c");e.pushScopeId("data-v-08a8f40c");const o={class:"vue3-waterfall",id:"waterfallBox"},r={class:"vue3-waterfall-scroller",ref:"scrollElRef"},i={class:"vue3-waterfall-item_image"},a={class:"title"},n={class:"info"},s={key:0,class:"vue3-waterfall-loading"},c=e.createTextVNode(" 加载中... ");e.popScopeId();const d=l(((t,l,d,p,f,g)=>(e.openBlock(),e.createBlock("div",o,[e.createVNode("div",r,[(e.openBlock(!0),e.createBlock(e.Fragment,null,e.renderList(t.waterfallList,((l,o)=>(e.openBlock(),e.createBlock("div",{key:o,class:"vue3-waterfall-item",style:{top:l._top+"px",left:l._left+"px",width:l._width+"px",height:l._height+"px"}},[e.createVNode("div",i,[e.renderSlot(t.$slots,"default",{item:l},(()=>[e.createVNode("img",{src:l.imgSrc},null,8,["src"])]),!0)]),e.createVNode("div",{class:"vue3-waterfall-item_footer",style:{height:t.footerHeight+"px"}},[e.renderSlot(t.$slots,"footer",{item:l},(()=>[e.createVNode("p",a,e.toDisplayString(l.title),1),e.createVNode("p",n,e.toDisplayString(l.info),1)]),!0)],4)],4)))),128))],512),t.isPreloading?(e.openBlock(),e.createBlock("div",s,[e.renderSlot(t.$slots,"loading",{},(()=>[c]),{},!0)])):e.createCommentVNode("",!0)]))));return t.render=d,t.__scopeId="data-v-08a8f40c",t}));
